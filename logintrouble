
class User():
   def __init__(self, username, hashedpass, id0, isadmin, active=True, password=None):
      self.username = username
      self.hashedpass = hashedpass 
      self.isadmin = isadmin
      self.id0 = id0
      self.password = password

   def isadmin(self):
      return self.isadmin

   def is_authenticated(self):
      return True

   def is_active(self):
      return self.is_authenticated()

   def is_anonymous(self):
      return False

   def get_id(self):
      return self.id0

   def validpassword(self, password):
      return checkpassword(password, self.password)

@app.route("/login", methods=["GET", "POST"])
def login():
    form = LoginForm()
    user = game.users.find_one( {'username' : form.username.data} )
       
    if form.validate_on_submit():
        # login and validate the user...

       if user is not None and user.valid_password(form.password.data):
           login_user(user, remember=True)
           flash("Logged in successfully.")
           return redirect(request.args.get("next") or url_for("index"))
       
       else:
          flash('Wrong username or password!', 'error')

    return render_template("login.html", form=form)  

@login_manager.user_loader
def load_user(userid):
   u = game.users.find_one( {"id" : userid })
   return User(u['name'], userid, u['admin'], active=True)


